name: Deploy Web App

on:
  push:
    branches:
      - main
  workflow_dispatch:
    inputs:
      build-new-version:
        description: 'Build now and deploy the app'
        default: 'true'
        required: false


jobs:
  deploy-web-app:
    uses: Practica-Supervisada-UCR-2025/Repo-DevOps/.github/workflows/deploy-app-reusable-workflow.yml@feature/deployment-reusable-workflow
    with:
      app_path: '.'
      image_name: "backend-user-app"
      container_name: "backend-user-app"
      production_server_port: "3001"
      program_assigned_port: "3000"

    secrets:
      DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
      DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
      DEPLOYMENT_SERVER_HOST: ${{ secrets.DEPLOYMENT_SERVER_HOST }}
      SERVER_USER: ${{ secrets.SERVER_USER }}
      SERVER_SSH_KEY: ${{ secrets.SERVER_SSH_KEY }}
      FIREBASE_CREDENTIALS: ${{ secrets.FIREBASE_CREDENTIALS }}
      DB_HOST: ${{ secrets.DB_HOST }}
      DB_USER: ${{ secrets.DB_USER }}
      DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
      DB_NAME: ${{ secrets.DB_NAME }}
      DB_PORT: ${{ secrets.DB_PORT }}      
